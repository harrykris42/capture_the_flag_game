<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questions</title>
    <style>
        #timer {
            font-size: 20px;
            color: red;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div id="timer">Time remaining: <span id="timer-value">15</span> seconds</div>
    
    <form id="answer-form">
        <p>What color is the sky?</p>
        <input type="text" id="answer" name="answer" required>
        <button type="button" id="submit-answer" disabled onclick="submitAnswer()">Submit Answer</button>
    </form>

    <p id="try-again-message" style="display: none; color: red;">Incorrect answer. Please try again.</p>
    <p id="congrats-message" style="display: none; color: green;">Congratulations! You have successfully completed the challenge!</p>

    <script>
        var timerValue = 15;
        var timerInterval;

        function updateTimer() {
            document.getElementById('timer-value').textContent = timerValue;
        }

        function startTimer() {
            timerInterval = setInterval(function () {
                if (timerValue > 0) {
                    timerValue -= 1;
                    updateTimer();
                } else {
                    clearInterval(timerInterval);

                    // Timer has run out
                    document.getElementById('submit-answer').disabled = true;

                    // Display the disqualified page
                    window.location.href = "/disqualified";
                }
            }, 1000);
        }

        function submitAnswer() {
            var answer = document.getElementById('answer').value.toLowerCase();

            // Check the answer for the common question
            if (answer === 'blue') {
                // Record the time when the correct answer is submitted
                clearInterval(timerInterval);

                // Display "Congratulations" message
                document.getElementById('congrats-message').style.display = 'block';

                // Send the answer to the server using AJAX
                fetch(`/submit_answer/team1`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ answer: answer }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'correct') {
                        // Redirect to the correct answer and congratulate page
                        window.location.href = "/correct_answer_and_congratulate";
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            } else {
                // Display "Try Again" message
                document.getElementById('try-again-message').style.display = 'block';

                // Send the answer to the server using AJAX
                fetch(`/submit_answer/team1`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ answer: answer }),
                })
                .then(response => response.json())
                .then(data => {
                    // Handle the server response if needed
                    // You can add more logic here if necessary
                })
                .catch(error => {
                    console.error('Error:', error);
                })
                .finally(() => {
                    // Add any additional logic you need to execute after the fetch completes
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            startTimer();

            // Enable the submit button when the answer is entered
            var answerInput = document.getElementById('answer');
            var submitButton = document.getElementById('submit-answer');

            answerInput.addEventListener('input', function () {
                submitButton.disabled = false;
            });

            document.addEventListener('keypress', function (event) {
                if (event.key === 'Enter' && document.activeElement === answerInput) {
                    event.preventDefault();
                    submitButton.click();
                }
            });

            submitButton.addEventListener('click', function () {
                submitAnswer();
            });
        });
    </script>
</body>
</html>
